<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>桐陰祭136-4</title>
  <style>
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; height: 100%; width: 100%; font-family: sans-serif; }
    body {
      background-image: url('宇宙.png');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center center;
      background-color: #000;
      color: #a8ff60;
      display: flex; justify-content: center; align-items: center;
      position: relative;
    }
    body::before {
      content: "";
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.65); z-index: 0;
    }
    .container {
      position: relative; z-index: 1;
      max-width: 600px; width: 90%; padding: 40px 30px; border-radius: 12px; text-align: center;
    }
    h1 { font-size: 2.5rem; margin-bottom: 30px; text-shadow: 0 0 8px #a8ff60; }
    p { font-size: 1.5rem; margin: 20px 0; text-shadow: 0 0 6px #a8ff60; }
    input {
      font-size: 1.2rem; padding: 12px; width: 80%; max-width: 400px; margin-top: 20px;
      border: 2px solid #a8ff60; background-color: rgba(18, 26, 0, 0.7);
      color: #a8ff60; border-radius: 6px; outline: none;
    }
    input:focus { border-color: #d4ff8c; background-color: rgba(33, 48, 0, 0.85); }
    button {
      font-size: 1.2rem; padding: 12px 24px; margin-top: 30px; cursor: pointer;
      background-color: rgba(34, 68, 0, 0.8); border: 2px solid #a8ff60; color: #a8ff60; border-radius: 8px;
    }
    button:hover { background-color: #3eb800; color: #000; border-color: #3eb800; }
    #incorrect-screen, #correct-screen-1, #correct-screen-2, #correct-screen-3, #correct-screen-4, #correct-screen-5 { display: none; }
  </style>
</head>
<body>

<!-- クイズ画面 -->
<div class="container" id="quiz-screen">
  <h1>答えを入力してください</h1>
  <p>※ひらがなで入力すること</p>
  <input type="text" id="answer" placeholder="ここに入力" autocomplete="off" onkeydown="handleKey(event)" />
  <button onclick="checkAnswer()">送信</button>
</div>

<!-- 正解画面1 -->
<div class="container" id="correct-screen-1">
  <h1>通信記録</h1>
  <p>あかさたな</p>
  <button onclick="location.reload()">戻る</button>
  <p style="font-size:0.9rem; color:#a8ff60a0;">※スペースキーでも戻れます</p>
</div>

<!-- 正解画面2 -->
<div class="container" id="correct-screen-2">
  <h1>船員情報</h1>
  <p>ABCDE</p>
  <button onclick="location.reload()">戻る</button>
  <p style="font-size:0.9rem; color:#a8ff60a0;">※スペースキーでも戻れます</p>
</div>

<!-- 正解画面3 -->
<div class="container" id="correct-screen-3">
  <h1>実験記録</h1>
  <p>12345</p>
  <button onclick="location.reload()">戻る</button>
  <p style="font-size:0.9rem; color:#a8ff60a0;">※スペースキーでも戻れます</p>
</div>

<!-- 正解画面4 -->
<div class="container" id="correct-screen-4">
  <h1>生物情報</h1>
  <p>X-6914</p>
  <button onclick="location.reload()">戻る</button>
  <p style="font-size:0.9rem; color:#a8ff60a0;">※スペースキーでも戻れます</p>
</div>

<!-- 正解画面5 -->
<div class="container" id="correct-screen-5">
  <h1>日記・後日譚</h1>
  <p>なぞときおわり</p>
  <button onclick="location.reload()">戻る</button>
  <p style="font-size:0.9rem; color:#a8ff60a0;">※スペースキーでも戻れます</p>
</div>

<!-- 不正解画面 -->
<div class="container" id="incorrect-screen">
  <h1>ERROR</h1>
  <p>答えが異なります。<br>あと <span id="countdown">3</span> 秒で自動で戻ります。</p>
</div>

<script>
let countdownInterval = null;

function handleKey(event) {
  if (event.key === "Enter") {
    if (document.getElementById('incorrect-screen').style.display === 'block') {
      event.preventDefault();
      return;
    }
    checkAnswer();
  }
}

// スペースキーで正解画面から再挑戦
document.addEventListener('keydown', function(event) {
  for (let i = 1; i <= 5; i++) {
    if (document.getElementById('correct-screen-'+i).style.display === 'block') {
      if (event.key === ' ') {
        event.preventDefault();
        location.reload();
      }
    }
  }
  if (document.getElementById('incorrect-screen').style.display === 'block') {
    if (event.key === 'Enter' || event.key === ' ') event.preventDefault();
  }
});

// ひらがな化
function normalizeInput(str) {
  return str.replace(/[ァ-ヴ]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0x60))
            .replace(/\s+/g, '')
            .toLowerCase();
}

function checkAnswer() {
  const userAnswer = normalizeInput(document.getElementById("answer").value.trim());
  document.getElementById("quiz-screen").style.display = "none";

  if (countdownInterval) clearInterval(countdownInterval);

  // 正解判定
  if (["つうしんしつ"].includes(userAnswer)) {
    document.getElementById("correct-screen-1").style.display = "block";
  } else if (["かもつしつ"].includes(userAnswer)) {
    document.getElementById("correct-screen-2").style.display = "block";
  } else if (["いりょうしつ"].includes(userAnswer)) {
    document.getElementById("correct-screen-3").style.display = "block";
  } else if (["せいぶつしつ"].includes(userAnswer)) {
    document.getElementById("correct-screen-4").style.display = "block";
  } else if (["さいご"].includes(userAnswer)) {
    document.getElementById("correct-screen-5").style.display = "block";
  } else {
    document.getElementById("incorrect-screen").style.display = "block";
    startCountdown(3);
  }
}

function goBack() {
  if (countdownInterval) clearInterval(countdownInterval);
  document.getElementById("incorrect-screen").style.display = "none";
  document.getElementById("quiz-screen").style.display = "block";
  const input = document.getElementById("answer");
  input.value = "";
  input.focus();
}

function startCountdown(seconds) {
  const countdownElem = document.getElementById("countdown");
  let remaining = seconds;
  countdownElem.textContent = remaining;
  countdownInterval = setInterval(() => {
    remaining--;
    countdownElem.textContent = remaining;
    if (remaining <= 0) {
      clearInterval(countdownInterval);
      countdownInterval = null;
      goBack();
    }
  }, 1000);
}
</script>

</body>
</html>
